<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Datainsight PsyPro — Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS principal -->
  <link rel="stylesheet" href="assets/branding-V2.css">
</head>
<body>

  <!-- NAVBAR -->
  <div class="navbar">
    <div class="wrap">
      <div class="logo">
        <img src="assets/datainsight.png" alt="Datainsight SST Consulting">
        <span>DATASINSIGHT PSYPRO</span>
      </div>
    </div>
  </div>

  <!-- CONTEÚDO -->
  <div class="container">
    <div class="login-box">
      <img src="assets/datainsight.png" alt="Datainsight SST Consulting">

      <h2 style="text-align:center; margin-top:8px;">AVALIA NR01 PRO — Acesso</h2>
      <p class="card-subtitle" style="text-align:center;">
        Acesse com seu usuário profissional.
      </p>

      <form id="loginForm" class="login-form">
        <label>
          Usuário (e-mail)
          <input id="username" type="text" placeholder="seu email profissional">
        </label>

        <label>
          Senha
          <input id="password" type="password" placeholder="Sua senha">
        </label>

        <button type="submit" class="btn primary full">Entrar</button>
      </form>
    </div>
  </div>

  <div class="footer">
    © 2025 DATASINSIGHT PSYPRO — Acesso Profissional
  </div>

  <!-- JAVASCRIPT -->
  <script>
    // URL da API em produção (Render)
    const API_URL = "https://datainsight-psypro.onrender.com";

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!username || !password) {
        alert("Preencha usuário e senha.");
        return;
      }

      // envia igual ao Swagger: application/x-www-form-urlencoded
      const body = new URLSearchParams();
      body.append('username', username);
      body.append('password', password);
      body.append('grant_type', 'password');

      try {
        const res = await fetch(`${API_URL}/api/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body
        });

        if (!res.ok) {
          alert("Login inválido. Verifique e-mail e senha.");
          return;
        }

        const data = await res.json();
        // guarda token e nome
        localStorage.setItem('token', data.access_token);
        localStorage.setItem('user_name', data.user.name);

        // vai para o dashboard
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        alert("Não foi possível conectar ao servidor. Verifique sua conexão ou tente novamente mais tarde.");
      }
    });
  </script>

</body>
</html>



